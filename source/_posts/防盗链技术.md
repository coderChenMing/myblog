---
title: 防盗链技术
date: 2020-01-15 19:36:16
updated: 2020-01-15 20:45:12
tags: web安全
categories: 架构设计
---
## 盗链
    指在自己的页面上展示一些并不在自己服务器上的内容
    通常的做法是通过技术手段获得它人服务器上的资源地址，绕过别人的资源展示页面，直接在自己的页面上向最终用户提供此内容.
    比较常见的是一些小站盗用大站的资源（图片、音乐、视频、软件等），对于这些小站来说，通过盗链的方法可以减轻自己服务器的负担，
    因为真实的空间和流量均是来自别人的服务器。
## 防盗链
    防止别人通过一些技术手段绕过本站的资源展示页面，盗用本站的资源，让绕开本站资源展示页面的资源链接失效。
    实施防盗链系统后，因为屏蔽了那些盗链的间接资源请求，从而可以大大减轻服务器及带宽的压力，也正如此，
    越来越多的站点都开始实施防盗链技术。
## 实现
    1.第三方网站访问下载非本地域名图片,视频,文件等资源时进行阻止下载,通过设置黑白名单,限制资源在制定服务器(域名)才能访问
    2.在HTTP协议中，有一个表头字段叫referer，采用URL的格式来表示从哪儿链接到当前的网页或文件。
      换句话说，通过referer，网站可以检测目标网页访问的来源网页，如果是资源文件，则可以跟踪到显示它的网页地址。
      有了referer跟踪来源就好办了，通过校验Http请求头中的referer,一旦检测到来源不是本站即进行阻止或者返回指定的页面。
    
   ![](/images/security/referer.png) 
## 具体实现细节
    判断Http请求头referer域中的记录来源的值,如果和当前访问的域名不一致,说明该图片可能被其他服务器盗用
    实现: 限制资源(图片,视频，文件等)只能在某个域名(限制某个服务器)来源上进行访问 
    使用过滤器拦截请求,判断请求头中的域名(referer记录)与需要限制的域名访问是否一致,如果不一致,说明可能被盗用,进行拦截
    eg: 自己访问自己域名一致,可以访问资源
        第三方网站访问域名referer是第三方网站域名,与本地域名不一致,提示不能访问
    测试: localhost:9090 页面直接访问http://localhost:8080/imgs/01.png,提示不能访问该图片
    直接访问http://localhost:8080/imgs/01.png,提示不能访问该图片
    进入localhost:8080自己页面后,访问该图片,访问成功
    eg: 视频云里黑白名单控制,即使你知道视频地址也无法播放